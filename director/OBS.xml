<?xml version="1.0" encoding="ISO-8859-1" ?>
<?xml-stylesheet href="director.xsl" type="text/xsl" ?>
<director name="template" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="director.xsd">
  <documentation>
    <author name="Lukas Stefanski, Owen Lake" alias="stefanski, Xenon_Slayer" contact="MSN, ICQ, skype, foren pm" />
    <content reference="OBS" name="Mission Director Opponent Balancing System" description="The OBS is a system to balance how many enemy ships will be created in a mission"/>
    <version number="0.5" date="18/05/2008" status="testing"/>
  </documentation>
  <cues>
    <cue name="OBS" library="1" comment="start of the balancing system">
      <documentation>
        <content name="Oponent Balancing System" reference="OBS" type="utility"/>
        <version date="18/05/2008" number="0.5" status="testing"/>
        <params>
          <param name="OBS Cue" description="The cue name where the ship groups are saved too"/>
          <param name="OBS Cancel Cue" description="The cue which is canceled after the OBS finishes"/>
          <param name="OBS Points" type="number" compulsory="0" description="A fixed amount to use"/>
          <param name="OBS PointsMin" type="number" compulsory="0" description="A minimum amount to use"/>
          <param name="OBS PointsMax" type="number" compulsory="0" description="A maximum amount to use"/>
          <param name="OBS Fleet Group Name" description="The group name where all main ships are saved too"/>
          <param name="OBS Support Fleet Group Name" description="The group name where all support ships are saved too"/>
          <param name="OBS Mother Ship Group Name" description="The group name where all ships with owned ships are saved too"/>
          <param name="OBSFleetRace" description="The maker race ID of the ships or the racemask 'default' or 'pirategroup'"/>
          <param name="OBSFleetPilotsRace" description="The race ID of the pilots"/>
          <param name="OBSFleetRelation" type="number" description="-1,0,1 OBS fleet relation to the player"/>
          <param name="OBSFleetJobTextID" type="number" description="Job text id of shipname"/>
          <param name="OBSMissionRank" description="A 0-30 scale preferably based on the players fight rank"/>
          <param name="OBSDifficultyRank" description="A 1-8 scale of difficulty"/>
          <param name="CheckCurrentEnemies" type="boolean" description="Count the number of enemies in the area to lower the amount of enemies"/>
          <param name="OBSPosition" description="how far away should the OBS ships be from FleetPositionObject"/>
          <param name="OBSFleetPositionObject" description="The object which will provide the location information"/>
          <param name="OBSSector" description="The sector where the ships will spawn if OBSFleetPositionObject not set"/>
          <param name="OBS X" description="Co-ordinate value in KM if the OBSFleetPositionObject was not set"/>
          <param name="OBS Y" description="Co-ordinate value in KM if the OBSFleetPositionObject was not set"/>
          <param name="OBS Z" description="Co-ordinate value in KM if the OBSFleetPositionObject was not set"/>
          <param name="OBSFleetCapturable" description="0/1 Sets if the created ships are capturable"/>
          <param name="OBSFleetCommunicates" description="0/1 Sets if the created ships can be communicated with"/>
          <param name="OBSFleetCovered" description="0/1 Sets if created pirate ships are covered"/>
          <param name="OBSFleetHomebaseID" description="Object ID for the fleets homebase"/>
          <param name="OBSFleetScanned"  description="0/1 Sets if the created ships have their freight on display"/>
          <param name="OBSFleetHighlight" description="0/1 Sets if the created ships will be highlighted"/>
          <param name="OBSFleetRaceLogic" description="0/1 Sets if the created ships will have default race logic"/>
          <param name="OBS Dock Support" description="0/1 Sets if the created support ships are docked with their homebase"/>
          <param name="OBS Support Overflow" description="0/1 Sets if additional support ships are created outside when the homebase is full"/>
			<param name="OBS IncludeM7M" description="Should include M7M ships"/>
			<param name="OBS IncludeM7D" description="Should include M7D ships"/>
			<param name="OBS IncludeRace" description="Should include Race ships (M5)"/>
		</params>
        <history>
          <change date="10/05/2013" author="dillpickle" description="Added small chance for M7's to carry PALC's"/>
          <change date="26/05/2010" author="Owen Lake" description="Greatly simplified the points generation code. Greater and clearer variation to enemies depending on OBSMissionRank. Should allow X-TREME players to still have some casual missions."/>
          <change date="09/04/2010" author="enenra" description="Activated M8 and M7 to appear in missions and added several lines to give them missiles."/>
          <change date="20/08/2008" author="al_main" description="Tweaked engine tunings added"/>
          <change date="16/08/2008" author="al_main" description="Added object.exists check before adding equipment"/>
          <change date="14/08/2008" author="al_main" description="Balanced engine tunings to difficulty, fixed OBS points difficulties to lookup.level@..."/>
          <change date="10/08/2008" author="al_main" description="Added scanner and fight sw to OBS created ships"/>
          <change date="27/06/2008" author="al_main" description="Added warp='1' to created ships"/>
          <change date="27/06/2008" author="al_main" description="Split claculation into seperate library OBS Points, altered to use constants"/>
          <change date="06/06/2008" author="al_main" description="Added param.exists checks, Race setup, fleet job name and fleet relation to OBS End"/>
          <change date="03/06/2008" author="al_main" description="Fixed breaking if Sector param not supplied when using an object as the position"/>
          <change date="18/05/2008" author="Owen Lake" description="Changed the value generation. Fixed some things"/>
          <change date="11/02/2008" author="Owen Lake" description="Added the documentation Tags. Changed some SRST stuff"/>
        </history>
        <todo>
          <item date="23/06/2008" author="Owen Lake" description="Add param failsafes" priority="medium"/>
        </todo>
      </documentation>
      <action>
        <do_all>
          <!--set points if supplied-->
          <do_if value="{param.exists@OBS Points}" exact="1">
            <do_choose>
              <do_when value="{param@OBS Points}" min="1">
                <set_value name="OBS.TotalPointPool" exact="{param@OBS Points}"/>
              </do_when>
              <do_otherwise>
                <set_value name="OBS.TotalPointPool" exact="0"/>
              </do_otherwise>
            </do_choose>
          </do_if>
          <!--Creates the position beacon where the ships will be created near.-->
          <do_choose>
            <do_when value="{object.exists@{param@OBSFleetPositionObject}}" exact="0">
              <create_spacefly name="OBS.PositionBeacon" swarm="0">
                <position x="{param@OBS X}km" y="{param@OBS Y}km" z="{param@OBS Z}km"/>
                <sector sector="{param@OBSSector}"/>
              </create_spacefly>
              <set_command object="OBS.PositionBeacon" command="default"/>
            </do_when>
            <do_otherwise>
              <create_spacefly name="OBS.PositionBeacon" swarm="0">
                <position object="{param@OBSFleetPositionObject}" exact="{param@OBSPosition}"/>
                <sector sector="{object.sector@{param@OBSFleetPositionObject}}"/>
              </create_spacefly>
              <set_command object="OBS.PositionBeacon" command="default"/>
            </do_otherwise>
          </do_choose>
          <do_if value="{random.race@{param@OBSFleetPilotsRace}}" list="{lookup.race@pirate}|{lookup.race@yaki}" negate="1">
            <set_value name="OBS.Pilot Race" exact="{param@OBSFleetPilotsRace}"/>
          </do_if>
        </do_all>
      </action>
      <cues>
        <cue name="OBS Get Points" check="cancel">
          <condition>
            <check_value value="{value@OBS.TotalPointPool}" exact="0"/>
          </condition>
          <cues>
            <cue ref="OBS Points">
              <params>
                <param name="ValueName" value="OBS.TotalPointPool"/>
                <param name="EnemyPoints" value="OBS.EnemyPoints"/>
              </params>
            </cue>
          </cues>
        </cue>
        <cue name="OBS Check Points">
          <condition>
            <check_value value="{value@OBS.TotalPointPool}" exact="0" negate="1"/>
          </condition>
          <action>
            <do_all>
              <do_if value="{param.exists@OBS PointsMax}" exact="1">
                <do_if value="{param@OBS PointsMax}" min="1">
                  <do_if value="{value@OBS.TotalPointPool}" max="{param@OBS PointsMax}" negate="1">
                    <set_value name="OBS.TotalPointPool" exact="{param@OBS PointsMax}"/>
                  </do_if>
                </do_if>
              </do_if>
              <do_if value="{param.exists@OBS PointsMin}" exact="1">
                <do_if value="{param@OBS PointsMin}" min="1">
                  <do_if value="{value@OBS.TotalPointPool}" min="{param@OBS PointsMin}" negate="1">
                    <set_value name="OBS.TotalPointPool" exact="{param@OBS PointsMin}"/>
                  </do_if>
                </do_if>
              </do_if>
              <do_if value="{param@CheckCurrentEnemies}" exact="1">
                <set_value name="OBS.TotalPointPool" exact="{value@OBS.TotalPointPool}-{value@OBS.EnemyPoints}"/>
              </do_if>
              <set_value name="OBS.TempPointPool" exact="{value@OBS.TotalPointPool}"/>
            </do_all>
          </action>
          <cues>
            <cue name="OBS Choose Ships" version="2" comment="Chooses what ship class is to be created">
              <condition>
                <check_all>
                  <cue_is_complete cue="OBS Check Points"/>
                  <check_value value="{value@OBS.TotalPointPool}" min="1"/>
                </check_all>
              </condition>
              <action>
                <do_all>
                  <set_value name="OBS.SupportPointPool" exact="0" comment="Resets the SupportPointPool"/>

                  <!--Only get the support points if the group is provided-->
                  <do_if value="{param.exists@OBS Support Fleet Group Name}" exact="1" >
                    <set_value name="OBS.M1 Support Points" exact="{value@Constant {lookup.class@m1} Support Points}"/>
                  </do_if>

                  <!--Chooses the class based on the the TempPointPool value. Some randomisation is included.-->
                  <do_choose>
                    <do_when value="{value@OBS.TempPointPool}" min="{value@Constant {lookup.class@m1} Points}+{value@OBS.M1 Support Points}" comment="M1 or M2">
                      <do_any>
                        <do_all chance="66">
                          <set_value name="OBS.ShipClass" exact="{lookup.class@m1}"/>
                          <set_value name="OBS.SupportPointPool" exact="{value@OBS.M1 Support Points}" comment="Sets the Carriers Support Point Pool"/>
                        </do_all>
                        <set_value chance="34" name="OBS.ShipClass" exact="{lookup.class@m2}"/>
                      </do_any>
						<do_any>
							<set_value chance="20" name="OBS.IncludeM2M" exact="1"/>
							<set_value chance="80" name="OBS.IncludeM2M" exact="0"/>
						</do_any>
						<do_any>
							<set_value chance="20" name="OBS.IncludeM1M" exact="1"/>
							<set_value chance="80" name="OBS.IncludeM1M" exact="0"/>
						</do_any>
					</do_when>
                    <do_when value="{value@OBS.TempPointPool}" min="{value@Constant {lookup.class@m2} Points}" max="{value@Constant {lookup.class@m1} Points}+{value@OBS.M1 Support Points}-1" comment="M2 or M7">
                      <do_any>
                        <set_value chance="66" name="OBS.ShipClass" exact="{lookup.class@m2}"/>
                        <set_value chance="34" name="OBS.ShipClass" exact="{lookup.class@m7}"/>
                      </do_any>
                    </do_when>
                    <do_when value="{value@OBS.TempPointPool}" min="{value@Constant {lookup.class@m7} Points}" max="{value@Constant {lookup.class@m2} Points}-1" comment="M7 or M8">
                      <do_any>
                        <set_value chance="66" name="OBS.ShipClass" exact="{lookup.class@m7}"/>
                        <set_value chance="34" name="OBS.ShipClass" exact="{lookup.class@m8}"/>
                      </do_any>
					</do_when>
                    <do_when value="{value@OBS.TempPointPool}" min="{value@Constant {lookup.class@m8} Points}" max="{value@Constant {lookup.class@m7} Points}-1" comment="M6 or M8">
                      <do_any>
                        <set_value chance="66" name="OBS.ShipClass" exact="{lookup.class@m8}"/>
                        <set_value chance="34" name="OBS.ShipClass" exact="{lookup.class@m6}"/>
                      </do_any>
  					  <set_value name="OBS.IncludeM6M" exact="0"/>
                    </do_when>
                    <do_when value="{value@OBS.TempPointPool}" min="{value@Constant {lookup.class@m6} Points}" max="{value@Constant {lookup.class@m8} Points}-1" comment="M6 or M3">
                      <do_any>
                        <set_value chance="66" name="OBS.ShipClass" exact="{lookup.class@m6}"/>
                        <set_value chance="34" name="OBS.ShipClass" exact="{lookup.class@m3}"/>
                      </do_any>
						<do_any>
							<set_value chance="20" name="OBS.IncludeM6M" exact="1"/>
							<set_value chance="80" name="OBS.IncludeM6M" exact="0"/>
						</do_any>
						<set_value name="OBS.IncludeM3P" exact="0"/>
					</do_when>
                    <do_when value="{value@OBS.TempPointPool}" min="{value@Constant {lookup.class@m3} Points}" max="{value@Constant {lookup.class@m6} Points}-1" comment="M3 or M4">
                      <do_any>
                        <set_value chance="66" name="OBS.ShipClass" exact="{lookup.class@m3}"/>
                        <set_value chance="34" name="OBS.ShipClass" exact="{lookup.class@m4}"/>
                      </do_any>
						<do_any>
							<set_value chance="20" name="OBS.IncludeM3P" exact="1"/>
							<set_value chance="80" name="OBS.IncludeM3P" exact="0"/>
						</do_any>
						<set_value name="OBS.IncludeM4P" exact="0"/>
					</do_when>
					<do_when value="{value@OBS.TempPointPool}" min="{value@Constant {lookup.class@m4} Points}" max="{value@Constant {lookup.class@m3} Points}-1" comment="M4 or M5">
						<do_any>
							<set_value chance="66" name="OBS.ShipClass" exact="{lookup.class@m4}"/>
							<set_value chance="34" name="OBS.ShipClass" exact="{lookup.class@m5}"/>
						</do_any>
						<do_any>
							<set_value chance="20" name="OBS.IncludeM4P" exact="1"/>
							<set_value chance="80" name="OBS.IncludeM4P" exact="0"/>
						</do_any>
						<set_value name="OBS.IncludeM5P" exact="0"/>
					</do_when>
                    <do_otherwise comment="M5">
                      <set_value name="OBS.ShipClass" exact="{lookup.class@m5}"/>
                    </do_otherwise>
                  </do_choose>
                  <set_value name="OBS.TempPointPool" exact="{value@OBS.TempPointPool}-{value@Constant {value@OBS.ShipClass} Points}" comment="Reduces the Temp Point Pool by the class value"/>
                  <set_value name="OBS.TempSupportPointPool" exact="{value@OBS.SupportPointPool}"/>
                </do_all>
              </action>
              <cues>
                <cue name="OBS ref SRST" ref="SRST" comment="Selects a Typename based on the class and maker race supplied.">
                  <params>
                    <param name="Race ID" value="{param@OBSFleetRace}" comment="The maker race ID or the strings 'default' or 'pirategroup'"/>
                    <param name="Class ID" value="{value@OBS.ShipClass}" comment="The shipclass ID or the strings 'bigship', 'fighter' or 'freighter'"/>
                    <param name="Cue" value="OBS" comment="The Cue that the shiptype is saved too"/>
                    <param name="CancelCue" value="SRST"/>
					  <param name="Shiptype Address" value="OBS.ShipType"/>
					  <param name="Only List" value="{param@OBS Only List}"/>
					  <param name="Include M1P" value="{value@OBS.IncludeM1P}"/>
					  <param name="Include M2P" value="{value@OBS.IncludeM2P}"/>
					  <param name="Include M3P" value="{value@OBS.IncludeM3P}"/>
					  <param name="Include M4P" value="{value@OBS.IncludeM4P}"/>
					  <param name="Include M5P" value="{value@OBS.IncludeM5P}"/>
					  <param name="Include M6M" value="{value@OBS.IncludeM6M}"/>
					  <param name="Include M7M" value="{param@OBS IncludeM7M}"/>
					  <param name="Include M7D" value="{param@OBS IncludeM7D}"/>
					  <param name="Include TPP" value="{value@OBS.IncludeTPP}"/>
					  <param name="Include TSP" value="{value@OBS.IncludeTSP}"/>
					  <param name="Include Race" value="{parap@OBS IncludeRace}"/>
				  </params>
                </cue>
                <cue name="OBS Create Ship" version="3">
                  <condition>
                    <cue_cancelled cue="SRST"/>
                  </condition>
                  <action>
                    <do_choose>
                      <do_when value="{value@OBS.ShipType}" exact="0" comment="If no shiptype was found do not create a ship">
                        <do_if value="{value@OBS.TempPointPool}" max="0">
                          <set_value name="OBS.TempPointPool" exact="{value@OBS.TotalPointPool}"/>
                        </do_if>
                        <set_value name="OBS.FailCount" operation="add"/>
                        <do_if value="{value@OBS.FailCount}" min="50">
                          <set_value name="OBS.TotalPointPool" exact="0"/>
                          <cancel_cue cue="OBS Choose Ships"/>
                        </do_if>
                        <reset_cue cue="OBS Choose Ships"/>
                      </do_when>
                      <do_otherwise>
                        <set_value name="OBS.FailCount" operation="set"/>
                        <set_value name="OBS.ShipRace" exact="{random.race@{param@OBSFleetPilotsRace}}"/>
                        <do_choose>
                          <do_when value="{value@OBS.ShipRace}" list="{lookup.race@pirate}|{lookup.race@yaki}" comment="Sets a race for pirates and yaki">
                            <set_value name="OBS.Pilot Race" exact="{random.race@default}"/>
                          </do_when>
                          <do_when value="{value@OBS.ShipRace}" list="{lookup.race@enemy}|{lookup.race@friend}|{lookup.race@neutral}" comment="Sets a race for other races">
                            <set_value name="OBS.Pilot Race" exact="{lookup.type.maker@{value@OBS.ShipType}}"/>
                          </do_when>
                          <do_otherwise>
                            <set_value name="OBS.Pilot Race" exact="{value@OBS.ShipRace}"/>
                          </do_otherwise>
                        </do_choose>
                        <do_if>
                          <set_value name="OBS.Pilot Race" exact="{random.race@default}"/>
                        </do_if>
                        <create_ship name="{param@OBS Cue}.Temp Ship" homebase="{param@OBSFleetHomebaseID}" typename="{value@OBS.ShipType}" race="{value@OBS.ShipRace}" warp="1">
                          <position object="OBS.PositionBeacon"/>
                          <sector sector="{object.sector@OBS.PositionBeacon}"/>
                          <equipment loadout="default"/>
                          <pilot race="{value@OBS.Pilot Race}"/>
                        </create_ship>
                        <!--check ship exists to make sure we never add equipment to player ship-->
                        <do_if value="{object.exists@{param@OBS Cue}.Temp Ship}" exact="1">
                          <!--add basic equipment like scanner-->
                          <do_choose>
                            <do_when value="{object.cargoclass@{param@OBS Cue}.Temp Ship}" min="{lookup.type.cargoclass@SS_WARE_SCANNER3}">
                              <add_equipment object="{param@OBS Cue}.Temp Ship">
                                <ware typename="SS_WARE_SCANNER3" exact="1"/>
                              </add_equipment>
                            </do_when>
                            <do_otherwise>
                              <add_equipment object="{param@OBS Cue}.Temp Ship">
                                <ware typename="SS_WARE_SCANNER2" exact="1"/>
                              </add_equipment>
                            </do_otherwise>
                          </do_choose>
                          <!--add some engine tunings-->
                          <add_equipment object="{param@OBS Cue}.Temp Ship">
                            <ware typename="SS_WARE_TECH213" min="( ({object.equipment.SS_WARE_TECH213.maxcount@{param@OBS Cue}.Temp Ship}-{object.equipment.SS_WARE_TECH213.count@{param@OBS Cue}.Temp Ship}) * (1+{param@OBSDifficultyRank}) ) /12" max="{object.equipment.SS_WARE_TECH213.maxcount@{param@OBS Cue}.Temp Ship}-{object.equipment.SS_WARE_TECH213.count@{param@OBS Cue}.Temp Ship}"/>
                          </add_equipment>
                          <!--add some fight command software to make the ship look full-->
                          <add_equipment object="{param@OBS Cue}.Temp Ship" chance="70">
                            <ware typename="SS_WARE_SW_FIGHT_1" exact="1"/>
                          </add_equipment>
                          <add_equipment object="{param@OBS Cue}.Temp Ship" chance="40">
                            <ware typename="SS_WARE_SW_FIGHT_2" exact="1"/>
                          </add_equipment>
                          <!--add some missiles to M7Ms and M8s-->
                          <do_choose>
                            <!--Small chance for M7's to carry PALC's-->
                            <do_when value="{object.class@{param@OBS Cue}.Temp Ship}" exact="{lookup.class@m7}">
                              <do_choose>
                                <do_when value="{object.type@{param@OBS Cue}.Temp Ship}" list="{lookup.type@SS_SH_A_M7}|{lookup.type@SS_SH_B_M7}|{lookup.type@SS_SH_P_M7}|{lookup.type@SS_SH_S_M7}|{lookup.type@SS_SH_T_M7}|{lookup.type@SS_SH_PI_M7_P}|{lookup.type@SS_SH_X_M7}|{lookup.type@SS_SH_Y_M7_1}">
                                  <do_any>
                                    <add_cargo object="{param@OBS Cue}.Temp Ship" chance="20">
                                      <ware typename="SS_LASER_PAL" min="2" max="4"/>
                                    </add_cargo>
                                    <add_cargo object="{param@OBS Cue}.Temp Ship" chance="80">
                                      <ware typename="SS_WARE_ENERGY" min="2" max="4"/>
                                    </add_cargo>
                                  </do_any>
                                </do_when>
                                <do_when value="{object.type@{param@OBS Cue}.Temp Ship}" list="{lookup.type@SS_SH_A_M7M}|{lookup.type@SS_SH_B_M7M}|{lookup.type@SS_SH_P_M7M}|{lookup.type@SS_SH_S_M7M}|{lookup.type@SS_SH_T_M7M}|{lookup.type@SS_SH_Y_M7M}">
                                  <add_cargo object="{param@OBS Cue}.Temp Ship">
                                    <ware typename="SS_MISSILE_AF_CAPITAL" min="(20+2*{player.fightrank.rank})" max="(20+3*{player.fightrank.rank})"/>
                                    <ware typename="SS_MISSILE_TORP_CAPITAL" min="(20+2*{player.fightrank.rank})" max="(20+3*{player.fightrank.rank})"/>
                                  </add_cargo>
                                </do_when>
                                <do_otherwise>
                                  <do_if value="{object.type@{param@OBS Cue}.Temp Ship}" exact="{lookup.type@SS_SH_TR_M7M}">
                                    <add_cargo object="{param@OBS Cue}.Temp Ship">
                                      <ware typename="SS_MISSILE_USC_AF_CAPITAL" min="(20+2*{player.fightrank.rank})" max="(20+3*{player.fightrank.rank})"/>
                                      <ware typename="SS_MISSILE_USC_TORP_CAPITAL" min="(20+2*{player.fightrank.rank})" max="(20+3*{player.fightrank.rank})"/>
                                    </add_cargo>
                                  </do_if>
                                </do_otherwise>
                              </do_choose>
                            </do_when>
                            <do_when value="{object.class@{param@OBS Cue}.Temp Ship}" exact="{lookup.class@m8}">
                              <do_choose>
                                <do_when value="{object.type@{param@OBS Cue}.Temp Ship}" list="{lookup.type@SS_SH_A_M8}|{lookup.type@SS_SH_P_M8}|{lookup.type@SS_SH_S_M8}|{lookup.type@SS_SH_T_M8}">
                                  <add_cargo object="{param@OBS Cue}.Temp Ship">
                                    <ware typename="SS_MISSILE_BOMBER" min="(10+1*{player.fightrank.rank})" max="(10+2*{player.fightrank.rank})"/>
                                  </add_cargo>
                                </do_when>
                                <do_when value="{object.type@{param@OBS Cue}.Temp Ship}" exact="{lookup.type@SS_SH_USC_M8}">
                                  <add_cargo object="{param@OBS Cue}.Temp Ship">
                                    <ware typename="SS_MISSILE_USC_BOMBER" min="(10+1*{player.fightrank.rank})" max="(10+2*{player.fightrank.rank})"/>
                                  </add_cargo>
                                </do_when>
                              </do_choose>
                            </do_when>
                          </do_choose>
                          <do_if value="{param@OBSFleetPilotsRace}" list="{lookup.race@friend}|{lookup.race@neutral}|{lookup.race@enemy}">
                            <do_if value="{param.exists@OBSFleetJobTextID}" exact="1">
                              <set_value name="this.FleetJobTextID" exact="{param@OBSFleetRace}{param@OBSFleetJobTextID}"/>
                              <do_if value="{param@OBSFleetJobTextID}" min="9000000">
                                <set_value name="this.FleetJobTextID" exact="{param@OBSFleetJobTextID}"/>
                              </do_if>
                            </do_if>
                            <do_if value="{value@this.FleetJobTextID}" min="1000" negate="1">
                              <set_value name="this.FleetJobTextID" exact="100+{param@OBSFleetRace}"/>
                            </do_if>
                            <set_value name="this.jobtextset" exact="1"/>
                            <set_pilot_data object="{param@OBS Cue}.Temp Ship" jobtextid="{value@this.FleetJobTextID}"/>
                          </do_if>
                          <do_if value="{param.exists@OBSFleetJobTextID}" exact="1">
                            <do_if value="{value@this.jobtextset}" exact="1" negate="1">
                              <set_value name="this.FleetJobTextID" exact="{param@OBSFleetJobTextID}"/>
                              <set_pilot_data object="{param@OBS Cue}.Temp Ship" jobtextid="{value@this.FleetJobTextID}"/>
                            </do_if>
                          </do_if>
                        </do_if>
                        <!--set object name-->
                        <set_object name="{param@OBS Cue}.{param@OBS Fleet Group Name} {object@{param@OBS Cue}.Temp Ship}" value="{object@{param@OBS Cue}.Temp Ship}" group="{param@OBS Cue}.{param@OBS Fleet Group Name}"/>
                        <do_if value="{value@OBS.SupportPointPool}" min="1" comment="If the created ship will have owned ships">
                          <do_if value="{param.exists@OBS Mother Ship Group Name}" exact="1">
                            <add_object_to_group object="{param@OBS Cue}.{param@OBS Mother Ship Group Name} {object@{param@OBS Cue}.Temp Ship}" group="{param@OBS Cue}.{param@OBS Mother Ship Group Name}"/>
                          </do_if>
                        </do_if>
                        <!--Updates the TotalPointPool when the ship is created. Reset the TempPointPool-->
                        <do_choose>
                          <do_when value="{object.type@{param@OBS Cue}.Temp Ship}" list="{lookup.type@SS_SH_THINKER}|{lookup.type@SS_SH_THINKER14}|{lookup.type@SS_SH_THINKER27}">
                            <set_value name="OBS.TotalPointPool" exact="{value@OBS.TotalPointPool}-{value@Constant {lookup.class@m6} Points}"/>
                          </do_when>
                          <do_otherwise>
                            <set_value name="OBS.TotalPointPool" exact="{value@OBS.TotalPointPool}-{value@Constant {object.class@{param@OBS Cue}.Temp Ship} Points}"/>
                          </do_otherwise>
                        </do_choose>
                        <set_value name="OBS.TempPointPool" exact="{value@OBS.TotalPointPool}"/>
                      </do_otherwise>
                    </do_choose>
                  </action>
                  <cues>
                    <cue name="OBS Create Ship Reset" comment="If there are no support ships to create">
                      <condition>
                        <check_any>
                          <check_value value="{value@OBS.SupportPointPool}" max="0"/>
                          <check_value value="{value@OBS.TempSupportPointPool}" max="0"/>
                        </check_any>
                      </condition>
                      <action>
                        <do_all>
                          <remove_object object="{param@OBS Cue}.Temp Ship"/>
                          <reset_cue cue="OBS Choose Ships"/>
                        </do_all>
                      </action>
                    </cue>
                    <cue name="OBS Support Ships" check="cancel">
                      <condition>
                        <check_value value="{value@OBS.SupportPointPool}" min="1"/>
                      </condition>
                      <action>
                        <do_all>
                          <do_choose>
                            <do_when value="{value@OBS.TempSupportPointPool}" min="{value@Constant {lookup.class@m3} Points}" comment="M3 or M4">
                              <do_any>
                                <set_value chance="66" name="OBS.ShipClass" exact="{lookup.class@m3}"/>
                                <set_value chance="34" name="OBS.ShipClass" exact="{lookup.class@m4}"/>
                              </do_any>
                            </do_when>
                            <do_when value="{value@OBS.TempSupportPointPool}" min="{value@Constant {lookup.class@m4} Points}" max="{value@Constant {lookup.class@m3} Points}-1" comment="M4 or M5">
                              <do_any>
                                <set_value chance="66" name="OBS.ShipClass" exact="{lookup.class@m4}"/>
                                <set_value chance="34" name="OBS.ShipClass" exact="{lookup.class@m5}"/>
                              </do_any>
                            </do_when>
                            <do_when value="{value@OBS.TempSupportPointPool}" min="{value@Constant {lookup.class@m5} Points}" max="{value@Constant {lookup.class@m4} Points}-1" comment="M5">
                              <set_value name="OBS.ShipClass" exact="{lookup.class@m5}"/>
                            </do_when>
                          </do_choose>
                          <set_value name="OBS.TempSupportPointPool" exact="{value@OBS.TempSupportPointPool}-{value@Constant {value@OBS.ShipClass} Points}"/>
                        </do_all>
                      </action>
                      <cues>
                        <cue name="OBS Support Ship Typename Check" ref="SRST">
                          <params>
                            <param name="Race ID" value="{param@OBSFleetRace}" comment="The maker race ID or the strings 'default' or 'pirategroup'"/>
                            <param name="Class ID" value="{value@OBS.ShipClass}" comment="The shipclass ID or the strings 'bigship', 'fighter' or 'freighter'"/>
                            <param name="Cue" value="OBS" comment="The Cue that the shiptype is saved too"/>
                            <param name="CancelCue" value="SRST"/>
                            <param name="Shiptype Address" value="OBS.ShipType"/>
                          </params>
                        </cue>
                        <cue name="OBS Create Support Ship" version="4">
                          <condition>
                            <cue_cancelled cue="SRST"/>
                          </condition>
                          <action>
                            <do_choose>
                              <do_when value="{value@OBS.ShipType}" exact="0" comment="If no shiptype was found do not create a ship">
                                <do_if value="{value@OBS.TempSupportPointPool}" max="0">
                                  <set_value name="OBS.TempSupportPointPool" exact="{value@OBS.SupportPointPool}"/>
                                </do_if>
                                <set_value name="OBS.FailCount" operation="add"/>
                                <do_if value="{value@OBS.FailCount}" min="20">
                                  <set_value name="OBS.TotalPointPool"/>
                                  <cancel_cue cue="OBS Choose Ships"/>
                                </do_if>
                                <reset_cue cue="OBS Support Ships"/>
                              </do_when>
                              <do_otherwise>
                                <set_value name="OBS.Support Placement" exact="0" comment="Reset the placement"/>
                                <set_value name="OBS.ShipRace" exact="{random.race@{param@OBSFleetPilotsRace}}"/>
                                <do_choose>
                                  <do_when value="{value@OBS.ShipRace}" list="{lookup.race@pirate}|{lookup.race@yaki}" comment="Sets a race for pirates and yaki">
                                    <set_value name="OBS.Pilot Race" exact="{random.race@default}"/>
                                  </do_when>
                                  <do_when value="{value@OBS.ShipRace}" list="{lookup.race@enemy}|{lookup.race@friend}|{lookup.race@neutral}" comment="Sets a race for pirates and yaki">
                                    <set_value name="OBS.Pilot Race" exact="{lookup.type.maker@{value@OBS.ShipType}}"/>
                                  </do_when>
                                  <do_otherwise>
                                    <set_value name="OBS.Pilot Race" exact="{value@OBS.ShipRace}"/>
                                  </do_otherwise>
                                </do_choose>
                                <do_choose>
                                  <do_when value="{param@OBS Dock Support}" exact="1" comment="If the OBS is set to dock the support ships at their homebase">
                                    <do_choose>
                                      <do_when value="{object.dockedships.maxcount@{param@OBS Cue}.Temp Ship}-{object.dockedships.count@{param@OBS Cue}.Temp Ship}" min="1" comment="Check if there is enough docking space">
                                        <set_value name="OBS.Support Placement" exact="1" comment="Docked"/>
                                      </do_when>
                                      <do_otherwise>
                                        <do_if value="{param@OBS Support Overflow}" exact="1" comment="There is not enough docking slots. Can they spawn in space">
                                          <set_value name="OBS.Support Placement" exact="2" comment="Space"/>
                                        </do_if>
                                      </do_otherwise>
                                    </do_choose>
                                  </do_when>
                                  <do_otherwise>
                                    <set_value name="OBS.Support Placement" exact="2" comment="Space"/>
                                  </do_otherwise>
                                </do_choose>
                                <do_choose>
                                  <do_when value="{value@OBS.Support Placement}" exact="1" comment="Docked">
                                    <create_ship dockobject="{param@OBS Cue}.Temp Ship" name="{param@OBS Cue}.Temp Support Ship" homebase="{param@OBS Cue}.Temp Ship" typename="{value@OBS.ShipType}" race="{value@OBS.ShipRace}">
                                      <equipment loadout="default"/>
                                      <pilot race="{value@OBS.Pilot Race}"/>
                                    </create_ship>
                                  </do_when>
                                  <do_when value="{value@OBS.Support Placement}" exact="2" comment="Space">
                                    <create_ship name="{param@OBS Cue}.Temp Support Ship" homebase="{param@OBS Cue}.Temp Ship" typename="{value@OBS.ShipType}" race="{value@OBS.ShipRace}" warp="1">
                                      <position object="{object@{param@OBS Cue}.Temp Ship}"/>
                                      <sector sector="{object.sector@{param@OBS Cue}.Temp Ship}"/>
                                      <equipment loadout="default"/>
                                      <pilot race="{value@OBS.Pilot Race}"/>
                                    </create_ship>
                                  </do_when>
                                </do_choose>
                                <do_choose>
                                  <do_when value="{object.exists@{param@OBS Cue}.Temp Support Ship}" exact="1">
                                    <set_value name="OBS.FailCount" operation="set"/>
                                    <do_if value="{param.exists@OBS Support Fleet Group Name}" exact="1">
                                      <set_object name="{param@OBS Cue}.{param@OBS Support Fleet Group Name} {object@{param@OBS Cue}.Temp Support Ship}" value="{object@{param@OBS Cue}.Temp Support Ship}" group="{param@OBS Cue}.{param@OBS Support Fleet Group Name}"/>
                                    </do_if>
                                    <do_choose>
                                      <do_when value="{object.type@{param@OBS Cue}.Temp Support Ship}" list="{lookup.type@SS_SH_THINKER}|{lookup.type@SS_SH_THINKER14}|{lookup.type@SS_SH_THINKER27}">
                                        <set_value name="OBS.SupportPointPool" exact="{value@OBS.SupportPointPool}-{value@Constant {lookup.class@m6} Points}"/>
                                      </do_when>
                                      <do_otherwise>
                                        <set_value name="OBS.SupportPointPool" exact="{value@OBS.SupportPointPool}-{value@Constant {object.class@{param@OBS Cue}.Temp Support Ship} Points}"/>
                                      </do_otherwise>
                                    </do_choose>
                                    <set_value name="OBS.TotalPointPool" exact="{value@OBS.TotalPointPool}-{value@Constant {object.class@{param@OBS Cue}.Temp Support Ship} Points}"/>
                                    <remove_object object="{param@OBS Cue}.Temp Support Ship"/>
                                  </do_when>
                                  <do_otherwise>
                                    <set_value name="OBS.FailCount" operation="add"/>
                                  </do_otherwise>
                                </do_choose>
                              </do_otherwise>
                            </do_choose>
                          </action>
                          <cues>
                            <cue name="OBS Support Ship Reset">
                              <condition>
                                <cue_completed cue="OBS Create Support Ship"/>
                              </condition>
                              <action>
                                <reset_cue cue="OBS Support Ships"/>
                              </action>
                            </cue>
                          </cues>
                        </cue>
                      </cues>
                    </cue>
                  </cues>
                </cue>
              </cues>
            </cue>
            <cue name="OBS End">
              <condition>
                <check_value value="{value@OBS.TotalPointPool}" max="0"/>
              </condition>
              <action>
                <do_all>
                  <do_if value="{param.exists@OBSFleetCapturable}" exact="1">
                    <do_if value="{param@OBSFleetCapturable}" exact="0">
                      <set_group_capturable group="{param@OBS Cue}.{param@OBS Fleet Group Name}" capturable="0"/>
                      <set_group_capturable group="{param@OBS Cue}.{param@OBS Support Fleet Group Name}" capturable="0"/>
                    </do_if>
                    <do_if value="{param@OBSFleetCapturable}" exact="1">
                      <set_group_capturable group="{param@OBS Cue}.{param@OBS Fleet Group Name}" capturable="1"/>
                      <set_group_capturable group="{param@OBS Cue}.{param@OBS Support Fleet Group Name}" capturable="1"/>
                    </do_if>
                  </do_if>
                  <do_if value="{param.exists@OBSFleetScanned}" exact="1">
                    <do_if value="{param@OBSFleetScanned}" exact="0">
                      <set_group_scanned group="{param@OBS Cue}.{param@OBS Fleet Group Name}" scanned="0"/>
                      <set_group_scanned group="{param@OBS Cue}.{param@OBS Support Fleet Group Name}" scanned="0"/>
                    </do_if>
                    <do_if value="{param@OBSFleetScanned}" exact="1">
                      <set_group_scanned group="{param@OBS Cue}.{param@OBS Fleet Group Name}" scanned="1"/>
                      <set_group_scanned group="{param@OBS Cue}.{param@OBS Support Fleet Group Name}" scanned="1"/>
                    </do_if>
                  </do_if>
                  <do_if value="{param.exists@OBSFleetHighlight}" exact="1">
                    <do_if value="{param@OBSFleetHighlight}" exact="0">
                      <set_group_highlight group="{param@OBS Cue}.{param@OBS Fleet Group Name}" highlight="0"/>
                      <set_group_highlight group="{param@OBS Cue}.{param@OBS Support Fleet Group Name}" highlight="0"/>
                    </do_if>
                    <do_if value="{param@OBSFleetHighlight}" exact="1">
                      <set_group_highlight group="{param@OBS Cue}.{param@OBS Fleet Group Name}" highlight="1"/>
                      <set_group_highlight group="{param@OBS Cue}.{param@OBS Support Fleet Group Name}" highlight="1"/>
                    </do_if>
                  </do_if>
                  <do_if value="{param.exists@OBSFleetCovered}" exact="1">
                    <do_if value="{param@OBSFleetCovered}" exact="0">
                      <set_group_covered group="{param@OBS Cue}.{param@OBS Fleet Group Name}" covered="0"/>
                      <set_group_covered group="{param@OBS Cue}.{param@OBS Support Fleet Group Name}" covered="0"/>
                    </do_if>
                    <do_if value="{param@OBSFleetCovered}" exact="1">
                      <set_group_covered group="{param@OBS Cue}.{param@OBS Fleet Group Name}" covered="1"/>
                      <set_group_covered group="{param@OBS Cue}.{param@OBS Support Fleet Group Name}" covered="1"/>
                    </do_if>
                  </do_if>
                  <do_if value="{param.exists@OBSFleetCommunicates}" exact="1">
                    <do_if value="{param@OBSFleetCommunicates}" exact="0">
                      <set_group_communicates group="{param@OBS Cue}.{param@OBS Fleet Group Name}" communicates="0"/>
                      <set_group_communicates group="{param@OBS Cue}.{param@OBS Support Fleet Group Name}" communicates="0"/>
                    </do_if>
                    <do_if value="{param@OBSFleetCommunicates}" exact="1">
                      <set_group_communicates group="{param@OBS Cue}.{param@OBS Fleet Group Name}" communicates="1"/>
                      <set_group_communicates group="{param@OBS Cue}.{param@OBS Support Fleet Group Name}" communicates="1"/>
                    </do_if>
                  </do_if>
                  <do_if value="{param.exists@OBSFleetRelation}" exact="1">
                    <do_choose>
                      <do_when value="{param@OBSFleetRelation}" exact="-1">
                        <set_group_relation group="{param@OBS Cue}.{param@OBS Fleet Group Name}">
                          <relation object="{player.ship}" mutual="0" relation="enemy"/>
                        </set_group_relation>
                        <set_group_relation group="{param@OBS Cue}.{param@OBS Support Fleet Group Name}">
                          <relation object="{player.ship}" mutual="0" relation="enemy"/>
                        </set_group_relation>
                      </do_when>
                      <do_when value="{param@OBSFleetRelation}" exact="1">
                        <set_group_relation group="{param@OBS Cue}.{param@OBS Fleet Group Name}">
                          <relation object="{player.ship}" mutual="0" relation="friend"/>
                        </set_group_relation>
                        <set_group_relation group="{param@OBS Cue}.{param@OBS Support Fleet Group Name}">
                          <relation object="{player.ship}" mutual="0" relation="friend"/>
                        </set_group_relation>
                      </do_when>
                      <do_otherwise>
                        <set_group_relation group="{param@OBS Cue}.{param@OBS Fleet Group Name}">
                          <relation object="{player.ship}" mutual="0" relation="neutral"/>
                        </set_group_relation>
                        <set_group_relation group="{param@OBS Cue}.{param@OBS Support Fleet Group Name}">
                          <relation object="{player.ship}" mutual="0" relation="neutral"/>
                        </set_group_relation>
                      </do_otherwise>
                    </do_choose>
                  </do_if>
                  <do_if value="{param@OBSFleetPilotsRace}" exact="{lookup.race@pirate}">
                    <do_if value="{param@OBS Default Pirates}" exact="1" negate="1">
                      <set_owner object="OBS.PositionBeacon" race="argon"/>
                      <set_group_relation group="{param@OBS Cue}.{param@OBS Fleet Group Name}">
                        <relation object="OBS.PositionBeacon" relation="enemy"/>
                      </set_group_relation>
                      <set_group_relation group="{param@OBS Cue}.{param@OBS Support Fleet Group Name}">
                        <relation object="OBS.PositionBeacon" relation="enemy"/>
                      </set_group_relation>

                      <set_owner object="OBS.PositionBeacon" race="boron"/>
                      <set_group_relation group="{param@OBS Cue}.{param@OBS Fleet Group Name}">
                        <relation object="OBS.PositionBeacon" relation="enemy"/>
                      </set_group_relation>
                      <set_group_relation group="{param@OBS Cue}.{param@OBS Support Fleet Group Name}">
                        <relation object="OBS.PositionBeacon" relation="enemy"/>
                      </set_group_relation>

                      <set_owner object="OBS.PositionBeacon" race="paranid"/>
                      <set_group_relation group="{param@OBS Cue}.{param@OBS Fleet Group Name}">
                        <relation object="OBS.PositionBeacon" relation="enemy"/>
                      </set_group_relation>
                      <set_group_relation group="{param@OBS Cue}.{param@OBS Support Fleet Group Name}">
                        <relation object="OBS.PositionBeacon" relation="enemy"/>
                      </set_group_relation>

                      <set_owner object="OBS.PositionBeacon" race="split"/>
                      <set_group_relation group="{param@OBS Cue}.{param@OBS Fleet Group Name}">
                        <relation object="OBS.PositionBeacon" relation="enemy"/>
                      </set_group_relation>
                      <set_group_relation group="{param@OBS Cue}.{param@OBS Support Fleet Group Name}">
                        <relation object="OBS.PositionBeacon" relation="enemy"/>
                      </set_group_relation>

                      <set_owner object="OBS.PositionBeacon" race="teladi"/>
                      <set_group_relation group="{param@OBS Cue}.{param@OBS Fleet Group Name}">
                        <relation object="OBS.PositionBeacon" relation="enemy"/>
                      </set_group_relation>
                      <set_group_relation group="{param@OBS Cue}.{param@OBS Support Fleet Group Name}">
                        <relation object="OBS.PositionBeacon" relation="enemy"/>
                      </set_group_relation>
                    </do_if>
                  </do_if>
                  <destroy_object object="OBS.PositionBeacon"/>
                  <cancel_cue cue="{param@OBS Cancel Cue}"/>
                  <cancel_cue cue="OBS" instantiate="static"/>
                </do_all>
              </action>
            </cue>
          </cues>
        </cue>
      </cues>
    </cue>

    <cue name="OBS Points" library="1" version="3">
      <documentation>
        <params>
          <param name="ValueName" type="cuename" compulsory="1" description="Where to save the points value to"/>
          <param name="EnemyPoints" type="valuename" description="The current points of enemies in the sector."/>

          <!--Params usually passed to the OBS itself-->
          <param name="OBSMissionRank" description="A 0-30 scale preferably based on the players fight rank"/>
          <param name="OBSDifficultyRank" description="A 1-8 scale of difficulty"/>
          <param name="OBSFleetPilotsRace" description="The race ID of the pilots"/>
        </params>
      </documentation>
      <action>
        <do_all>
          <do_if value="{param.exists@EnemyPoints}" exact="1">
            <find_ship group="this.Enemies" race="{param@OBSFleetPilotsRace}" multiple="1" max="50">
              <position object="OBS.PositionBeacon"/>
              <sector sector="{object.sector@OBS.PositionBeacon}"/>
              <distance max="40km"/>
            </find_ship>
            <do_all exact="{group.object.count@this.Enemies}" counter="Count">
              <set_value name="{param@EnemyPoints}" operation="add" exact="{value@Constant {group.object.{counter@Count}.class@this.Enemies} Points}"/>
            </do_all>
          </do_if>

          <set_value name="this.PointPool" exact="{value@Constant OBS PP Rank{param@OBSMissionRank}}"/>
          <do_choose>
            <do_when value="{param@OBSDifficultyRank}" exact="{lookup.level@trivial}" comment="1">
              <set_value name="this.RandomNumber" min="5" max="12"/>
            </do_when>
            <do_when value="{param@OBSDifficultyRank}" exact="{lookup.level@veryeasy}" comment="2">
              <set_value name="this.RandomNumber" min="15" max="22"/>
            </do_when>
            <do_when value="{param@OBSDifficultyRank}" exact="{lookup.level@easy}" comment="3">
              <set_value name="this.RandomNumber" min="25" max="42"/>
            </do_when>
            <do_when value="{param@OBSDifficultyRank}" exact="{lookup.level@average}" comment="4">
              <set_value name="this.RandomNumber" min="45" max="52"/>
            </do_when>
            <do_when value="{param@OBSDifficultyRank}" exact="{lookup.level@hard}" comment="5">
              <set_value name="this.RandomNumber" min="55" max="62"/>
            </do_when>
            <do_when value="{param@OBSDifficultyRank}" exact="{lookup.level@veryhard}" comment="6">
              <set_value name="this.RandomNumber" min="65" max="72"/>
            </do_when>
            <do_when value="{param@OBSDifficultyRank}" exact="{lookup.level@impossible}" comment="7">
              <set_value name="this.RandomNumber" min="75" max="82"/>
            </do_when>
            <do_when value="{param@OBSDifficultyRank}" exact="8" comment="UNUSED?">
              <set_value name="this.RandomNumber" min="85" max="100"/>
            </do_when>
            <do_otherwise>
              <set_value name="this.RandomNumber1" min="45" max="55"/>
            </do_otherwise>
          </do_choose>
          <set_value name="this.PointPoolModification" exact="({value@this.PointPool}+1)*{value@this.RandomNumber}"/>
          <set_value name="{param@ValueName}" exact="{value@this.PointPoolModification}/100"/>
          <do_if value="{value@{param@ValueName}}" max="0">
            <set_value name="{param@ValueName}" exact="1"/>
          </do_if>
        </do_all>
      </action>
    </cue>
  </cues>
  <signature>nM/xOM/jx2Z0wPIXuYp16F36RVF2D3y+cZyiF+zqm2ggDN5sd5K5wAB9HojV+swBnQ1wYlyq07o+tFDFQotr/XOzlpBCtcWdRuxoNK82Z6wK0cqR85ockRKXMCvq8TLyGybmjDcocO7qINM/bEKtwmQN9bPBpqVqbbDzF1fbsBF1UsranKBTeDQcMJdz+XQl+ziXS9EvaSrp4dzIdyJmNvbvJSR90PlszEYnmddCxcYDICCFjcXpzMPMOO7XwUtZk45+1HwoG6Auzj8GRLfyyBD7JWLVawcOXowLpuo57MvTCNIz3GM9IyXY2i5ugvI/+LKhwXewsSad60cKFaCCgQ==</signature>
</director>

