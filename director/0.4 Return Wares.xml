<?xml version="1.0" encoding="ISO-8859-1" ?>
<?xml-stylesheet href="director.xsl" type="text/xsl" ?>
<director name="test" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="director.xsd">
  <documentation>
    <author name="Al" alias="al_main" contact="e-mail: al_main@hotmail.com"/>
    <content reference="Level 0 Mission 4" name="Return Wares" description="Mission to retrieve some wares"/>
    <version number="0.6" date="02/06/08" status="development"/>
  </documentation>

  <cues>
    <cue name="L0M04 B" library="1">
      <documentation>
        <content name="L0M04 Return Wares" reference="TXXX" type="briefing" />
        <version number="0.6" date="02/06/08" status="development"/>
        <params>
          <param name="Cue" type="cuename" compulsory="1" description="The cue where the briefing and objectives are stored"/>
          <param name="ID" type="number" compulsory="1" description="The mission ID for dealing with mission chains"/>
          <param name="OfferRace" compulsory="1" description="Race offering the mission"/>
          <param name="EnemyRace" compulsory="1" description="Race of the enemy"/>
          <param name="Lv1Guide" compulsory="1" description="The person offering the mission"/>
          <param name="PageID" compulsory="1" description="Page ID of mission description"/>
          <param name="TextID" compulsory="1" description="Text ID of mission description"/>
          <param name="RewardCr" type="valuename" compulsory="0" description="Reward type" default="Standard credit reward"/>
          <param name="RewardFree" type="text" compulsory="0" description="Reward - free text"/>
          <param name="StoryID" compulsory="0" description="Text ID of the Story title" default="No title"/>
          <param name="ChapterID" compulsory="0" description="Text ID of the chapter title" default="No title"/>
          <param name="LeaveTitle" compulsory="0" description="Do not generate a title"/>
          <param name="BriefingBackground" type="text" compulsory="0" description="Briefing Background to be used"/>
          <param name="Difficulty" compulsory="1" description="The difficulty of the mission" default="trivial"/>
          <param name="IsPlot" compulsory="0" description="If the mission is a plot mission or not" default="non-plot"/>
          <param name="Step" type="number" compulsory="0" description="Step to begin the briefing on" default="Step 1"/>
          <param name="Station" type="objectname" compulsory="0" description="Station to deliver to"/>
          <param name="Buyer" compulsory="0" description="Actor to deliver to"/>
          <param name="Ware1" type="number" compulsory="1" description="Ware to be delivered first"/>
          <param name="Ware1Amt" type="number" compulsory="1" description="Amount of Ware1 to be delivered"/>
          <param name="Ware2" type="number" compulsory="0" description="Ware to be delivered second"/>
          <param name="Ware2Amt" type="number" compulsory="0" description="Amount of Ware2 to be delivered"/>
          <param name="Ware3" type="number" compulsory="0" description="Ware to be delivered third"/>
          <param name="Ware3Amt" type="number" compulsory="0" description="Amount of Ware3 to be delivered"/>
        </params>
        <returns>
          <return name="{param@Cue}.{param@ID} L0M04 Progress" type="number" description="1 - Mission Completed"/>
          <return name="{param@Cue}.{param@ID} L0M04 Progress" type="number" description="2 - Out of time"/>
          <return name="{param@Cue}.{param@ID} L0M04 Progress" type="number" description="5 - Player Ejected Pilot. Not used"/>
          <return name="{param@Cue}.{param@ID} L0M04 Progress" type="number" description="6 - Destination Destroyed"/>
          <return name="{param@Cue}.{param@ID} L0M04 Progress" type="number" description="7 - Destination Destroyed by player"/>
          <return name="{param@Cue}.{param@ID} L0M04 Progress" type="number" description="99 - Mission Aborted"/>
        </returns>
        <history>
          <change date="02/05/13" author="Owen Lake" description="Added check when ware is removed from player whether add_cargo or add_equipment should be used"/>
          <change date="12/11/12" author="Dillpickle" description="Change so just reward free will show"/>
          <change date="02/06/08" author="al_main" description="Fix to timer settings"/>
          <change date="17/04/08" author="al_main" description="ID + Summary now used to differentiate in L1 chain"/>
          <change date="10/03/08" author="al_main" description="Fix to very low reward when 0 amount wares specified"/>
          <change date="08/02/08" author="al_main" description="Rewritten to use dynamically defined briefing steps"/>
        </history>
        <todo>
        </todo>
      </documentation>
      <action>
        <do_all>
          <do_choose>
            <do_when value="{param@Summary}" exact="1">
              <create_briefing cue="{param@Cue}">
				  <requirements name="{1904,60301}">
					  <requirement value="{param@Ware1}" visible="{value@{param@Cue}.{param@ID} L0M04Ware1Amt}" type="ware"/>
					  <requirement value="{param@Ware2}" visible="{value@{param@Cue}.{param@ID} L0M04Ware2Amt}" type="ware"/>
					  <requirement value="{param@Ware3}" visible="{value@{param@Cue}.{param@ID} L0M04Ware3Amt}" type="ware"/>
				  </requirements>
                <objectives>
                  <objective step="{param@Step}">
                    <custom icon="deliver" action="{35,2003}" text="{35,2133}"/>
                  </objective>
                </objectives>
              </create_briefing>
              <cancel_cue cue="L0M04 B"/>
            </do_when>
            <do_otherwise>
              <set_value name="{param@Cue}.{param@ID} L0Step" exact="{param@Step}"/>
              <do_if value="{value@{param@Cue}.{param@ID} L0Step}" min="1" negate="1">
                <set_value name="{param@Cue}.{param@ID} L0Step" exact="1"/>
              </do_if>
              <do_if value="{param.exists@IsPlot}" exact="0">
                <set_value name="{param@Cue}.{param@ID} L0Time" min="3500" max="7000"/>
                <do_if value="{param.exists@Difficulty}" exact="1">
                  <do_if value="{param@Difficulty}" min="1">
                    <set_value name="{param@Cue}.{param@ID} L0Time" exact="{value@{param@Cue}.{param@ID} L0Time}/{param@Difficulty}"/>
                  </do_if>
                </do_if>
              </do_if>
              <set_value name="{param@Cue}.{param@ID} L0M04Ware1" exact="{param@Ware1}"/>
              <set_value name="{param@Cue}.{param@ID} L0M04Ware2" exact="{param@Ware2}"/>
              <set_value name="{param@Cue}.{param@ID} L0M04Ware3" exact="{param@Ware3}"/>
              <set_value name="{param@Cue}.{param@ID} L0M04Ware1Amt" exact="{param@Ware1Amt}"/>
              <set_value name="{param@Cue}.{param@ID} L0M04Ware2Amt" exact="{param@Ware2Amt}"/>
              <set_value name="{param@Cue}.{param@ID} L0M04Ware3Amt" exact="{param@Ware3Amt}"/>
              <set_value name="{param@Cue}.{param@ID} L0Title" exact="0"/>
              <do_choose>
                <do_when value="{param.exists@LeaveTitle}" exact="0">
                  <set_value name="{param@Cue}.{param@ID} L0Title" min="1001" max="{3604,1000}" profile="decreasing"/>
                </do_when>
                <do_otherwise>
                  <do_if value="{param@LeaveTitle}" exact="0">
                    <set_value name="{param@Cue}.{param@ID} L0Title" min="1001" max="{3604,1000}" profile="decreasing"/>
                  </do_if>
                </do_otherwise>
              </do_choose>
              <do_if value="{param@Ware1}" exact="0">
                <set_value name="{param@Cue}.{param@ID} L0M04Ware1" exact="{lookup.type@SS_WARE_ENERGY}"/>
              </do_if>
              <do_if value="{value@{param@Cue}.{param@ID} L0M04Ware1Amt}" exact="0">
                <set_value name="{param@Cue}.{param@ID} L0M04Ware1Amt" min="500/{lookup.type.price@{value@{param@Cue}.{param@ID} L0M04Ware1}}" max="4000/{lookup.type.price@{value@{param@Cue}.{param@ID} L0M04Ware1}}"/>
              </do_if>
              <do_if value="{value@{param@Cue}.{param@ID} L0M04Ware1Amt}" negate="1" min="1">
                <set_value name="{param@Cue}.{param@ID} L0M04Ware1Amt" min="1" max="3"/>
              </do_if>
              <do_if value="{param@Ware2}" exact="0">
                <set_value name="{param@Cue}.{param@ID} L0M04Ware2Amt" exact="0"/>
              </do_if>
              <do_if value="{param@Ware3}" exact="0">
                <set_value name="{param@Cue}.{param@ID} L0M04Ware3Amt" exact="0"/>
              </do_if>

              <do_if value="{param.exists@RewardCr}" exact="1">
                <do_if value="{value@{param@RewardCr}}" exact="0">
                  <set_value name="this.warevalue" min="({lookup.type.price@{value@{param@Cue}.{param@ID} L0M04Ware1}}*{value@{param@Cue}.{param@ID} L0M04Ware1Amt})+({lookup.type.price@{value@{param@Cue}.{param@ID} L0M04Ware2}}*{value@{param@Cue}.{param@ID} L0M04Ware2Amt})+({lookup.type.price@{value@{param@Cue}.{param@ID} L0M04Ware3}}*{value@{param@Cue}.{param@ID} L0M04Ware3Amt})" max="({lookup.type.maxprice@{value@{param@Cue}.{param@ID} L0M04Ware1}}*{value@{param@Cue}.{param@ID} L0M04Ware1Amt})+({lookup.type.maxprice@{value@{param@Cue}.{param@ID} L0M04Ware2}}*{value@{param@Cue}.{param@ID} L0M04Ware2Amt})+({lookup.type.maxprice@{value@{param@Cue}.{param@ID} L0M04Ware3}}*{value@{param@Cue}.{param@ID} L0M04Ware3Amt})" profile="bell"/>
                  <set_value name="this.bonus" exact="{reward.money.{param@OfferRace}@{param@Difficulty}.TXXX}"/>
                  <set_value name="{param@RewardCr}" exact="{value@this.warevalue}+{value@this.bonus}"/>
                </do_if>
              </do_if>
              <set_value name="{param@Cue}.{param@ID} L0M04Ware1Total" exact="{value@{param@Cue}.{param@ID} L0M04Ware1Amt}"/>
              <set_value name="{param@Cue}.{param@ID} L0M04Ware2Total" exact="{value@{param@Cue}.{param@ID} L0M04Ware2Amt}"/>
              <set_value name="{param@Cue}.{param@ID} L0M04Ware3Total" exact="{value@{param@Cue}.{param@ID} L0M04Ware3Amt}"/>

              <do_choose>
                <do_when value="{object.exists@{param@Station}}" exact="1">
                  <set_object name="{param@Cue}.{param@ID} L0M04Station" value="{object@{param@Station}}" comment="Station to deliver to"/>
                </do_when>
                <do_when value="{actor.exists@{param@Buyer}}" exact="1">
                  <set_object name="{param@Cue}.{param@ID} L0M04Station" value="{actor.station@{param@Buyer}}" comment="Station to deliver to"/>
                </do_when>
                <do_otherwise>
                  <find_station name="{param@Cue}.{param@ID} L0M04Station" findobject="{player.ship}" class="station" dockingallowed="1" enemy="0">
                    <sector sector="{player.sector}"/>
                    <jumps min="0" max="2"/>
                  </find_station>
                  <!--MAYBE BETTER STATION FINDING LOGIC NEEDED, AND BACKUP INCASE NONE?-->
                </do_otherwise>
              </do_choose>
              <do_if value="{value@{param@Cue}.{param@ID} L0Title}" min="1">
                <create_briefing cue="{param@Cue}" title="{3604,{value@{param@Cue}.{param@ID} L0Title}}"/>
              </do_if>
              <do_if value="{param.exists@PageID}" exact="1">
                <do_if value="{param.exists@TextID}" exact="1">
                  <create_briefing cue="{param@Cue}" text="{{param@PageID},{param@TextID}}"/>
                </do_if>
              </do_if>
              <create_briefing cue="{param@Cue}">
				  <requirements name="{1904,60301}">
					  <requirement value="{param@Ware1}" visible="{value@{param@Cue}.{param@ID} L0M04Ware1Amt}" type="ware"/>
					  <requirement value="{param@Ware2}" visible="{value@{param@Cue}.{param@ID} L0M04Ware2Amt}" type="ware"/>
					  <requirement value="{param@Ware3}" visible="{value@{param@Cue}.{param@ID} L0M04Ware3Amt}" type="ware"/>
				  </requirements>
				  <objectives>
                  <objective step="{value@{param@Cue}.{param@ID} L0Step}">
                    <!--<thumbnails>
                      <thumbnail image="{lookup.type.image@{value@{param@Cue}.{param@ID} L0M04Ware1}}"/>
                      <thumbnail image="{lookup.race.image@{param@OfferRace}}"/>
                      <thumbnail image="{object.type.image@{param@Cue}.{param@ID} L0M04Station}"/>
                    </thumbnails>-->
                    <deliver object="{object@{param@Cue}.{param@ID} L0M04Station}">
                      <ware typename="{value@{param@Cue}.{param@ID} L0M04Ware1}" exact="{value@{param@Cue}.{param@ID} L0M04Ware1Amt}"/>
                    </deliver>
                  </objective>
                </objectives>
              </create_briefing>
              <do_if value="{value@{param@Cue}.{param@ID} L0M04Ware2Amt}" min="1" comment="If ware 2 is set add to briefing">
                <create_briefing cue="{param@Cue}">
				  <requirements name="{1904,60301}">
					  <requirement value="{param@Ware1}" visible="{value@{param@Cue}.{param@ID} L0M04Ware1Amt}" type="ware"/>
					  <requirement value="{param@Ware2}" visible="{value@{param@Cue}.{param@ID} L0M04Ware2Amt}" type="ware"/>
					  <requirement value="{param@Ware3}" visible="{value@{param@Cue}.{param@ID} L0M04Ware3Amt}" type="ware"/>
				  </requirements>
					<objectives>
                    <objective step="{value@{param@Cue}.{param@ID} L0Step}+1">
                      <!--<thumbnails>
                        <thumbnail image="{lookup.type.image@{value@{param@Cue}.{param@ID} L0M04Ware2}}"/>
                        <thumbnail image="{lookup.race.image@{param@OfferRace}}"/>
                        <thumbnail image="{object.type.image@{param@Cue}.{param@ID} L0M04Station}"/>
                      </thumbnails>-->
                      <deliver object="{object@{param@Cue}.{param@ID} L0M04Station}">
                        <ware typename="{value@{param@Cue}.{param@ID} L0M04Ware2}" exact="{value@{param@Cue}.{param@ID} L0M04Ware2Amt}"/>
                      </deliver>
                    </objective>
                  </objectives>
                </create_briefing>
              </do_if>
              <do_if value="{value@{param@Cue}.{param@ID} L0M04Ware3Amt}" min="1" comment="If ware 3 is set add to briefing">
                <create_briefing cue="{param@Cue}">
				  <requirements name="{1904,60301}">
					  <requirement value="{param@Ware1}" visible="{value@{param@Cue}.{param@ID} L0M04Ware1Amt}" type="ware"/>
					  <requirement value="{param@Ware2}" visible="{value@{param@Cue}.{param@ID} L0M04Ware2Amt}" type="ware"/>
					  <requirement value="{param@Ware3}" visible="{value@{param@Cue}.{param@ID} L0M04Ware3Amt}" type="ware"/>
				  </requirements>
					<objectives>
                    <objective step="{value@{param@Cue}.{param@ID} L0Step}+2">
                      <!--<thumbnails>
                        <thumbnail image="{lookup.type.image@{value@{param@Cue}.{param@ID} L0M04Ware3}}"/>
                        <thumbnail image="{lookup.race.image@{param@OfferRace}}"/>
                        <thumbnail image="{object.type.image@{param@Cue}.{param@ID} L0M04Station}"/>
                      </thumbnails>-->
                      <deliver object="{object@{param@Cue}.{param@ID} L0M04Station}">
                        <ware typename="{value@{param@Cue}.{param@ID} L0M04Ware3}" exact="{value@{param@Cue}.{param@ID} L0M04Ware3Amt}"/>
                      </deliver>
                    </objective>
                  </objectives>
                </create_briefing>
              </do_if>
            </do_otherwise>
          </do_choose>
          <set_value name="L0M04 B.StartTime" exact="{player.age}+7200"/>
        </do_all>
      </action>
      <cues>
        <cue ref="LUM04">
          <params>
            <param name="Discipline" value="XXXT"/>
            <param name="StartTime" value="L0M04 B.StartTime"/>
            <param name="Duration" value="{param@Cue}.{param@ID} L0Time"/>
          </params>
        </cue>
      </cues>
    </cue>

    <cue name="L0M04" library="1">
      <documentation>
        <content name="L0M04 Return Wares" reference="TXXX" type="L0" />
        <version number="0.6" date="02/06/08" status="development"/>
        <params>
          <param name="Cue" compulsory="1" description="The cue where the briefing and objectives are stored"/>
          <param name="ID" type="number" compulsory="1" description="The mission Id for dealing with mission chains"/>
          <param name="OfferRace" compulsory="1" description="Race offering the mission"/>
          <param name="EnemyRace" compulsory="1" description="Race of the enemy"/>
          <param name="Lv1Guide" compulsory="1" description="The person offering the mission"/>
          <param name="PageID" compulsory="1" description="Page ID of mission description"/>
          <param name="TextID" compulsory="1" description="Text ID of mission description"/>
          <param name="RewardCr" compulsory="0" description="Reward type" default="Standard credit reward"/>
          <param name="StoryID" compulsory="0" description="Text ID of the Story title" default="No title"/>
          <param name="ChapterID" compulsory="0" description="Text ID of the chapter title" default="No title"/>
          <param name="Difficulty" compulsory="1" description="The difficulty of the mission" default="trivial"/>
          <param name="IsPlot" compulsory="0" description="If the mission is a plot mission or not" default="non-plot"/>
          <param name="Step" compulsory="0" description="Step to begin the briefing on" default="Step 1"/>
          <param name="AddText" type="boolean" compulsory="0" description="Whether to add the mission description to the incoming message"/>
          <param name="NoMessage" type="boolean" description="Attempt to speak messages"/>
          <param name="AddToStation" type="boolean" compulsory="0" description="Whether to add the wares to the station"/>
        </params>
        <history>
          <change date="31/08/08" author="al_main" description="Fixed voice on delivering wares"/>
          <change date="04/08/08" author="al_main" description="Fixed readtext error from text 2001 when plot actor"/>
          <change date="15/06/08" author="al_main" description="Fixed destroyed station bug"/>
          <change date="02/06/08" author="al_main" description="Major restructuring to allow mulitple wares at once and fix extra objective bug"/>
          <change date="12/05/08" author="al_main" description="Added beaming sound to ship to ship delivery"/>
          <change date="08/05/08" author="al_main" description="Added ship to ship delivery support"/>
          <change date="17/04/08" author="al_main" description="ID + Summary now used to differentiate in L1 chain"/>
          <change date="08/02/08" author="al_main" description="Rewritten to use dynamically defined briefing steps"/>
        </history>
        <todo>
          <item priority="critical" description="Change incoming messages to spoken text, and silent incoming?"/>
          <item priority="critical" description="Out of time fail!"/>
          <item priority="high" description="ADD CONVERSATION TO DELIVERY RECEIVER INCASE PLAYER WANTS TO TALK TO HIM?"/>
          <item priority="medium" description="Alter time based on difficulty?"/>
          <item priority="low" description="ENEMY INVOLVEMENT?"/>
          <item priority="trivial" description="'WHERES MY CARGO?' MESSAGE IF DOCKING WITHOUT CARGO POSSIBLY?"/>
          <item priority="trivial" description="MULTIPLE DESTINATIONS, OR BEST TO CALL MISSION SEPERATELY?"/>
        </todo>
      </documentation>
      <action>
        <do_all>
          <set_value name="L0M04.Ware1Needed" exact="{value@{param@Cue}.{param@ID} L0M04Ware1Amt}"/>
          <set_value name="L0M04.Ware2Needed" exact="{value@{param@Cue}.{param@ID} L0M04Ware2Amt}"/>
          <set_value name="L0M04.Ware3Needed" exact="{value@{param@Cue}.{param@ID} L0M04Ware3Amt}"/>
          <set_value name="L0M04.SendMessage" exact="1"/>
          <do_if value="{param.exists@NoMessage}" exact="1">
            <do_if value="{param@NoMessage}" exact="1">
              <set_value name="L0M04.SendMessage" exact="0"/>
            </do_if>
          </do_if>
          <do_choose>
            <!--NEEDS SELECTION OF MESSAGE FOR DIFFERENT OFFFER RACES-->
            <do_when value="{param@AddText}" min="1">
              <incoming_message author="{actor.name@{param@Lv1Guide}}" text="{{param@PageID},{param@TextID}}\n\n{3604,101}"/>
            </do_when>
            <do_otherwise>
              <incoming_message author="{actor.name@{param@Lv1Guide}}" text="{3604,101}"/>
            </do_otherwise>
          </do_choose>
          <do_if value="{value@{param@Cue}.{param@ID} L0Title}" min="1">
            <set_objective cue="{param@Cue}" title="{3604,{value@{param@Cue}.{param@ID} L0Title}}"/>
          </do_if>
          <set_objective cue="{param@Cue}">
            <briefing cue="{param@Cue}" step="{value@{param@Cue}.{param@ID} L0Step}"/>
            <mission level="{param@Difficulty}" discipline="TXXX"/>
            <progress current="0" limit="{value@{param@Cue}.{param@ID} L0M04Ware1Total}"/>
            <deliver object="{param@Cue}.{param@ID} L0M04Station">
              <ware typename="{value@{param@Cue}.{param@ID} L0M04Ware1}" exact="{value@{param@Cue}.{param@ID} L0M04Ware1Amt}"/>
            </deliver>
          </set_objective>
          <set_value name="L0M04.StartTime" exact="{player.age}"/>
        </do_all>
      </action>
      <cues>
        <cue ref="LUM04">
          <params>
            <param name="StartTime" value="L0M04.StartTime"/>
            <param name="Duration" value="{param@Cue}.{param@ID} L0Time"/>
          </params>
        </cue>
        <cue ref="LUM05">
          <params>
            <param name="StartTime" value="L0M04.StartTime"/>
            <param name="Duration" value="{param@Cue}.{param@ID} L0Time"/>
          </params>
        </cue>
        <cue name="L0M04 Mission">
          <cues>
			  <cue name="L0M04 Player Docked" delay="2s">
				  <condition>
					  <check_all>
						  <match_object object="{param@Cue}.{param@ID} L0M04Station" class="station"/>
						  <check_value value="{object.dockedships.count@{param@Cue}.{param@ID} L0M04Station}" min="1"/>
					  </check_all>
				  </condition>
				  <action>
					  <do_all>
						  <set_value name="{param@Cue}.{param@ID} L0M04_CheckDocked" exact="0"/>
						  <remove_group group="{param@Cue}.{param@ID} L0M04_DockedShips"/>
						  <do_all exact="{object.dockedships.count@{param@Cue}.{param@ID} L0M04Station}" counter="Docked">
							  <set_object name="{param@Cue}.{param@ID} L0M04_Temp Docked Ship_{counter@Docked}" value="{object.dockedships.{counter@Docked}@{param@Cue}.{param@ID} L0M04Station}"/>
							  <do_if value="{object.race@{param@Cue}.{param@ID} L0M04_Temp Docked Ship_{counter@Docked}}" exact="{lookup.race@player}">
								  <do_choose>
									  <do_when value="{object.cargo.{value@{param@Cue}.{param@ID} L0M04Ware1}.exists@{object@{param@Cue}.{param@ID} L0M04_Temp Docked Ship_{counter@Docked}}}*{value@L0M04.Ware1Needed}" min="1">
										  <add_object_to_group group="{param@Cue}.{param@ID} L0M04_DockedShips" object="{param@Cue}.{param@ID} L0M04_Temp Docked Ship_{counter@Docked}"/>
									  </do_when>
									  <do_when value="{object.cargo.{value@{param@Cue}.{param@ID} L0M04Ware2}.exists@{object@{param@Cue}.{param@ID} L0M04_Temp Docked Ship_{counter@Docked}}}*{value@L0M04.Ware2Needed}" min="1">
										  <add_object_to_group group="{param@Cue}.{param@ID} L0M04_DockedShips" object="{param@Cue}.{param@ID} L0M04_Temp Docked Ship_{counter@Docked}"/>
									  </do_when>
									  <do_when value="{object.cargo.{value@{param@Cue}.{param@ID} L0M04Ware3}.exists@{object@{param@Cue}.{param@ID} L0M04_Temp Docked Ship_{counter@Docked}}}*{value@L0M04.Ware3Needed}" min="1">
										  <add_object_to_group group="{param@Cue}.{param@ID} L0M04_DockedShips" object="{param@Cue}.{param@ID} L0M04_Temp Docked Ship_{counter@Docked}"/>
									  </do_when>
								  </do_choose>
							  </do_if>
						  </do_all>
						  <do_if value="{group.object.count@{param@Cue}.{param@ID} L0M04_DockedShips}" min="1">
							  <set_value name="{param@Cue}.{param@ID} L0M04_CheckDocked" exact="1"/>
							</do_if>
					  </do_all>
				  </action>
				  <cues>
					  <cue name="L0M04.ResetCueDocked">
						  <condition>
							  <check_value value="{value@{param@Cue}.{param@ID} L0M04_CheckDocked}" exact="0"/>
						  </condition>
						  <timing>
							  <time min="10s" max="20s"/>
						  </timing>
						  <action>
							  <do_all>
          					    <remove_group group="{param@Cue}.{param@ID} L0M04_DockedShips"/>
        						<reset_cue cue="L0M04 Player Docked"/>
        						<reset_cue cue="L0M04 Brought Wares"/>								  
							  </do_all>
						  </action>
					  </cue>
				  </cues>
			  </cue>
			  <cue name="L0M04 Player Close" delay="2s">
				  <condition>
					  <check_all>
						  <match_object object="{param@Cue}.{param@ID} L0M04Station" class="station" negate="1"/>
                          <check_distance value="{object.distance@{param@Cue}.{param@ID} L0M04Station}" max="5km"/>
					  </check_all>
				  </condition>
				  <action>
					  <do_all>
						  <set_value name="{param@Cue}.{param@ID} L0M04_CheckDocked" exact="0"/>
						  <remove_group group="{param@Cue}.{param@ID} L0M04_DockedShips"/>
						  <set_object name="{param@Cue}.{param@ID} L0M04_Temp Docked Ship" value="{player.ship}"/>
						  <do_choose>
							  <do_when value="{object.cargo.{value@{param@Cue}.{param@ID} L0M04Ware1}.exists@{object@{param@Cue}.{param@ID} L0M04_Temp Docked Ship}}*{value@L0M04.Ware1Needed}" min="1">
								  <add_object_to_group group="{param@Cue}.{param@ID} L0M04_DockedShips" object="{param@Cue}.{param@ID} L0M04_Temp Docked Ship"/>
							  </do_when>
							  <do_when value="{object.cargo.{value@{param@Cue}.{param@ID} L0M04Ware2}.exists@{object@{param@Cue}.{param@ID} L0M04_Temp Docked Ship}}*{value@L0M04.Ware2Needed}" min="1">
								  <add_object_to_group group="{param@Cue}.{param@ID} L0M04_DockedShips" object="{param@Cue}.{param@ID} L0M04_Temp Docked Ship"/>
							  </do_when>
							  <do_when value="{object.cargo.{value@{param@Cue}.{param@ID} L0M04Ware3}.exists@{object@{param@Cue}.{param@ID} L0M04_Temp Docked Ship}}*{value@L0M04.Ware3Needed}" min="1">
								  <add_object_to_group group="{param@Cue}.{param@ID} L0M04_DockedShips" object="{param@Cue}.{param@ID} L0M04_Temp Docked Ship"/>
							  </do_when>
						  </do_choose>
						  
						  <do_if value="{group.object.count@{param@Cue}.{param@ID} L0M04_DockedShips}" min="1">
							  <set_value name="{param@Cue}.{param@ID} L0M04_CheckDocked" exact="1"/>
							</do_if>
					  </do_all>
				  </action>
				  <cues>
					  <cue name="L0M04.ResetCueClose">
						  <condition>
							  <check_value value="{value@{param@Cue}.{param@ID} L0M04_CheckDocked}" exact="0"/>
						  </condition>
						  <timing>
							  <time min="10s" max="20s"/>
						  </timing>
						  <action>
							  <do_all>
          					    <remove_group group="{param@Cue}.{param@ID} L0M04_DockedShips"/>
        						<reset_cue cue="L0M04 Player Close"/>
        						<reset_cue cue="L0M04 Brought Wares"/>								  
							  </do_all>
						  </action>
					  </cue>
				  </cues>
			  </cue>
			  <cue name="L0M04 Brought Wares" delay="2s">
              <condition>
				  <check_all>
					  <check_value value="{value@{param@Cue}.{param@ID} L0M04_CheckDocked}" exact="1"/>
				  </check_all>
              </condition>
              <timing>
                <time exact="5s"/>
              </timing>
              <cues>
                <cue name="L0M04 Brought Wares Wait">
                  <condition>
                    <cue_completed cue="L0M04 Brought Wares"/>
                  </condition>
					<action>
       			        <set_value name="{param@Cue}.{param@ID} L0M04_CheckDocked" exact="0"/>			  
					</action>
                  <cues>
                    <cue name="L0M04 Still Brought Wares" check="cancel" version="2">						
                      <condition>
                        <check_any>
                            <any_object_is_docked dockobject="{object@{param@Cue}.{param@ID} L0M04Station}" group="{param@Cue}.{param@ID} L0M04_DockedShips"/>
                            <match_object object="{param@Cue}.{param@ID} L0M04Station" class="station" negate="1"/>
                        </check_any>
                      </condition>					  
                      <action>
                        <do_all>
                        <do_all exact="{group.object.count@{param@Cue}.{param@ID} L0M04_DockedShips}" counter="Count">
					        <set_object name="L0M04.Temp Docked Ship" value="{group.object.{counter@Count}@{param@Cue}.{param@ID} L0M04_DockedShips}"/>
                          <!--are these needed?-->
                          <set_value name="this.remove1" exact="0"/>
                          <set_value name="this.remove2" exact="0"/>
                          <set_value name="this.remove3" exact="0"/>
                          <set_value name="this.removed 1st ware" exact="0"/>
                          <set_value name="this.removed 2nd ware" exact="0"/>
                          <set_value name="this.removed 3rd ware" exact="0"/>
                          <set_value name="this.removed 1st amt" exact="0"/>
                          <set_value name="this.removed 2nd amt" exact="0"/>
                          <set_value name="this.removed 3rd amt" exact="0"/>

                          <!--check for cargoes-->
                          <do_if value="{object.cargo.{value@{param@Cue}.{param@ID} L0M04Ware1}.count@{object@L0M04.Temp Docked Ship}}" min="1">
                            <set_value name="this.remove1" exact="{value@L0M04.Ware1Needed}"/>
                            <do_if value="{value@L0M04.Ware1Needed}" min="{object.cargo.{value@{param@Cue}.{param@ID} L0M04Ware1}.count@{object@L0M04.Temp Docked Ship}}+1">
                              <set_value name="this.remove1" exact="{object.cargo.{value@{param@Cue}.{param@ID} L0M04Ware1}.count@{object@L0M04.Temp Docked Ship}}"/>
                            </do_if>
                            <do_choose>
                              <do_when value="{lookup.type.category@{value@{param@Cue}.{param@ID} L0M04Ware1}}" list="{lookup.category@shield}|{lookup.category@laser}">
                                <add_equipment object="{object@L0M04.Temp Docked Ship}">
                                  <ware typename="{value@{param@Cue}.{param@ID} L0M04Ware1}" exact="0-{value@this.remove1}"/>
                                </add_equipment>
                              </do_when>
                              <do_otherwise>
                                <add_cargo object="{object@L0M04.Temp Docked Ship}">
                                  <ware typename="{value@{param@Cue}.{param@ID} L0M04Ware1}" exact="0-{value@this.remove1}"/>
                                </add_cargo>
                              </do_otherwise>
                            </do_choose>
                            <do_if value="{param.exists@AddToStation}" exact="1">
                              <add_cargo object="{param@Cue}.{param@ID} L0M04Station">
                                <ware typename="{value@{param@Cue}.{param@ID} L0M04Ware1}" exact="{value@this.remove1}"/>
                              </add_cargo>
                            </do_if>
                            <set_value name="L0M04.Ware1Needed" exact="{value@L0M04.Ware1Needed}-{value@this.remove1}"/>
                            <set_value name="this.removed 1st ware" exact="{value@{param@Cue}.{param@ID} L0M04Ware1}"/>
                            <set_value name="this.removed 1st amt" exact="{value@this.remove1}"/>
                          </do_if>

                          <do_if value="{object.cargo.{value@{param@Cue}.{param@ID} L0M04Ware2}.count@{object@L0M04.Temp Docked Ship}}" min="1">
                            <set_value name="this.remove2" exact="{value@L0M04.Ware2Needed}"/>
                            <do_if value="{value@L0M04.Ware2Needed}" min="{object.cargo.{value@{param@Cue}.{param@ID} L0M04Ware2}.count@{object@L0M04.Temp Docked Ship}}+1">
                              <set_value name="this.remove2" exact="{object.cargo.{value@{param@Cue}.{param@ID} L0M04Ware2}.count@{object@L0M04.Temp Docked Ship}}"/>
                            </do_if>
                            <do_choose>
                              <do_when value="{lookup.type.category@{value@{param@Cue}.{param@ID} L0M04Ware2}}" list="{lookup.category@shield}|{lookup.category@laser}">
                                <add_equipment object="{object@L0M04.Temp Docked Ship}">
                                  <ware typename="{value@{param@Cue}.{param@ID} L0M04Ware2}" exact="0-{value@this.remove2}"/>
                                </add_equipment>
                              </do_when>
                              <do_otherwise>
                                <add_cargo object="{object@L0M04.Temp Docked Ship}">
                                  <ware typename="{value@{param@Cue}.{param@ID} L0M04Ware2}" exact="0-{value@this.remove2}"/>
                                </add_cargo>
                              </do_otherwise>
                            </do_choose>
                            <do_if value="{param.exists@AddToStation}" exact="1">
                              <add_cargo object="{param@Cue}.{param@ID} L0M04Station">
                                <ware typename="{value@{param@Cue}.{param@ID} L0M04Ware2}" exact="{value@this.remove2}"/>
                              </add_cargo>
                            </do_if>
                            <set_value name="L0M04.Ware2Needed" exact="{value@L0M04.Ware2Needed}-{value@this.remove2}"/>
                            <do_choose>
                              <do_when value="{value@this.removed 1st amt}" exact="0">
                                <set_value name="this.removed 1st ware" exact="{value@{param@Cue}.{param@ID} L0M04Ware2}"/>
                                <set_value name="this.removed 1st amt" exact="{value@this.remove2}"/>
                              </do_when>
                              <do_otherwise>
                                <set_value name="this.removed 2nd ware" exact="{value@{param@Cue}.{param@ID} L0M04Ware2}"/>
                                <set_value name="this.removed 2nd amt" exact="{value@this.remove2}"/>
                              </do_otherwise>
                            </do_choose>
                          </do_if>

                          <do_if value="{object.cargo.{value@{param@Cue}.{param@ID} L0M04Ware3}.count@{object@L0M04.Temp Docked Ship}}" min="1">
                            <set_value name="this.remove3" exact="{value@L0M04.Ware3Needed}"/>
                            <do_if value="{value@L0M04.Ware3Needed}" min="{object.cargo.{value@{param@Cue}.{param@ID} L0M04Ware3}.count@{object@L0M04.Temp Docked Ship}}+1">
                              <set_value name="this.remove3" exact="{object.cargo.{value@{param@Cue}.{param@ID} L0M04Ware3}.count@{object@L0M04.Temp Docked Ship}}"/>
                            </do_if>
                            <do_choose>
                              <do_when value="{lookup.type.category@{value@{param@Cue}.{param@ID} L0M04Ware3}}" list="{lookup.category@shield}|{lookup.category@laser}">
                                <add_equipment  object="{object@L0M04.Temp Docked Ship}">
                                  <ware typename="{value@{param@Cue}.{param@ID} L0M04Ware3}" exact="0-{value@this.remove3}"/>
                                </add_equipment>
                              </do_when>
                              <do_otherwise>
                                <add_cargo object="{object@L0M04.Temp Docked Ship}">
                                  <ware typename="{value@{param@Cue}.{param@ID} L0M04Ware3}" exact="0-{value@this.remove3}"/>
                                </add_cargo>
                              </do_otherwise>
                            </do_choose>
                            <do_if value="{param.exists@AddToStation}" exact="1">
                              <add_cargo object="{param@Cue}.{param@ID} L0M04Station">
                                <ware typename="{value@{param@Cue}.{param@ID} L0M04Ware3}" exact="{value@this.remove3}"/>
                              </add_cargo>
                            </do_if>
                            <set_value name="L0M04.Ware3Needed" exact="{value@L0M04.Ware3Needed}-{value@this.remove3}"/>
                            <do_choose>
                              <do_when value="{value@this.removed 1st amt}" exact="0">
                                <set_value name="this.removed 1st ware" exact="{value@{param@Cue}.{param@ID} L0M04Ware3}"/>
                                <set_value name="this.removed 1st amt" exact="{value@this.remove3}"/>
                              </do_when>
                              <do_when value="{value@this.removed 2nd amt}" exact="0">
                                <set_value name="this.removed 2nd ware" exact="{value@{param@Cue}.{param@ID} L0M04Ware3}"/>
                                <set_value name="this.removed 2nd amt" exact="{value@this.remove3}"/>
                              </do_when>
                              <do_otherwise>
                                <set_value name="this.removed 3rd ware" exact="{value@{param@Cue}.{param@ID} L0M04Ware3}"/>
                                <set_value name="this.removed 3rd amt" exact="{value@this.remove3}"/>
                              </do_otherwise>
                            </do_choose>
                          </do_if>
                          <set_value name="L0M04.WaresRemaining" exact="{value@L0M04.Ware1Needed}+{value@L0M04.Ware2Needed}+{value@L0M04.Ware3Needed}"/>

                          <!--play transdport sound-->
                          <do_if value="{player.dockobject.exists}" exact="0">
                            <play_sound soundid="991"/>
                          </do_if>

                          <!--check message needed and set progress-->
                          <do_choose>
                            <do_when value="{value@L0M04.WaresRemaining}" exact="0">
                              <set_value name="{param@Cue}.{param@ID} L0M04 Progress" exact="1"/>
                              <do_if value="{param.exists@NoMessage}" exact="1">
                                <do_if value="{param@NoMessage}" exact="1">
                                  <set_value name="L0M04.SendMessage" exact="0"/>
                                </do_if>
                              </do_if>
                            </do_when>
                            <do_otherwise>
                              <do_choose>
                                <do_when value="{value@L0M04.Ware1Needed}" min="1">
                                  <set_objective cue="{param@Cue}">
                                    <progress current="{value@{param@Cue}.{param@ID} L0M04Ware1Amt}-{value@L0M04.Ware1Needed}" limit="{value@{param@Cue}.{param@ID} L0M04Ware1Amt}"/>
                                    <deliver object="{param@Cue}.{param@ID} L0M04Station">
                                      <ware typename="{value@{param@Cue}.{param@ID} L0M04Ware1}" exact="{value@L0M04.Ware1Needed}"/>
                                    </deliver>
                                  </set_objective>
                                </do_when>
                                <do_when value="{value@L0M04.Ware2Needed}" min="1">
                                  <set_objective cue="{param@Cue}">
                                    <briefing cue="{param@Cue}" step="{value@{param@Cue}.{param@ID} L0Step}+1"/>
                                    <progress current="{value@{param@Cue}.{param@ID} L0M04Ware2Amt}-{value@L0M04.Ware2Needed}" limit="{value@{param@Cue}.{param@ID} L0M04Ware2Amt}"/>
                                    <deliver object="{param@Cue}.{param@ID} L0M04Station">
                                      <ware typename="{value@{param@Cue}.{param@ID} L0M04Ware2}" exact="{value@L0M04.Ware2Needed}"/>
                                    </deliver>
                                  </set_objective>
                                </do_when>
                                <do_otherwise>
                                  <set_objective cue="{param@Cue}">
                                    <briefing cue="{param@Cue}" step="{value@{param@Cue}.{param@ID} L0Step}+2"/>
                                    <progress current="{value@{param@Cue}.{param@ID} L0M04Ware3Amt}-{value@L0M04.Ware3Needed}" limit="{value@{param@Cue}.{param@ID} L0M04Ware3Amt}"/>
                                    <deliver object="{param@Cue}.{param@ID} L0M04Station">
                                      <ware typename="{value@{param@Cue}.{param@ID} L0M04Ware3}" exact="{value@L0M04.Ware3Needed}"/>
                                    </deliver>
                                  </set_objective>
                                </do_otherwise>
                              </do_choose>
                            </do_otherwise>
                          </do_choose>

                          <!--send message-->
                          <do_if value="{value@L0M04.SendMessage}" exact="1">
                            <do_choose>
                              <do_when value="{value@L0M04.WaresRemaining}" min="1">
                                <do_choose>
                                  <do_when value="{value@this.removed 3rd amt}" min="1">
                                    <set_value name="this.textid" min="701" max="{3604,700}"/>
                                  </do_when>
                                  <do_when value="{value@this.removed 2nd amt}" min="1">
                                    <set_value name="this.textid" min="601" max="{3604,600}"/>
                                  </do_when>
                                  <do_otherwise>
                                    <set_value name="this.textid" min="501" max="{3604,500}"/>
                                  </do_otherwise>
                                </do_choose>
                                <play_text actor="{param@Lv1Guide}" textid="2000"/>
                                <incoming_message author="{actor.name@{param@Lv1Guide}}" text="{3604,{value@this.textid}}" silent="1"/>
                              </do_when>
                              <do_otherwise>
                                <do_if value="{text.exists@{actor.voice@{param@Lv1Guide}},2001}" exact="1">
                                  <play_text actor="{param@Lv1Guide}" textid="2001"/>
                                  <incoming_message author="{actor.name@{param@Lv1Guide}}" text="{{actor.voice@{param@Lv1Guide}},2001}" silent="1"/>
                                </do_if>
                              </do_otherwise>
                            </do_choose>
                          </do_if>
                         </do_all>
                        </do_all>
                      </action>
                    </cue>
                  </cues>
                </cue>
              </cues>
            </cue>
            <cue name="L0M04 Time Out" check="cancel">
              <condition>
                <check_value value="{value@{param@Cue}.{param@ID} L0Time}" min="1"/>
              </condition>
              <timing>
                <time exact="{value@{param@Cue}.{param@ID} L0Time}s"/>
              </timing>
              <action>
                <set_value name="{param@Cue}.{param@ID} L0M04 Progress" exact="2"/>
              </action>
            </cue>
            <cue name="L0M04 Aborted">
              <condition>
                <objective_cancelled cue="{param@Cue}"/>
              </condition>
              <action>
                <set_value name="{param@Cue}.{param@ID} L0M04 Progress" exact="99"/>
              </action>
            </cue>
            <cue name="L0M04 Dest Destroyed Pl">
              <condition>
                <object_destroyed_by_player object="{param@Cue}.{param@ID} L0M04Station"/>
              </condition>
              <action>
                <do_all>
                  <cancel_cue cue="L0M04 Mission"/>
                  <set_value name="{param@Cue}.{param@ID} L0M04 Progress" exact="7"/>
                </do_all>
              </action>
            </cue>
            <cue name="L0M04 Dest Destroyed">
              <condition>
                <object_destroyed object="{param@Cue}.{param@ID} L0M04Station"/>
              </condition>
              <action>
                <do_choose>
                  <do_when value="{object.race@{event.param2}}" exact="{lookup.race@player}">
                    <cancel_cue cue="L0M04 Mission"/>
                    <set_value name="{param@Cue}.{param@ID} L0M04 Progress" exact="7"/>
                  </do_when>
                  <do_otherwise>
                    <cancel_cue cue="L0M04 Mission"/>
                    <set_value name="{param@Cue}.{param@ID} L0M04 Progress" exact="6"/>
                  </do_otherwise>
                </do_choose>
              </action>
            </cue>
          </cues>
        </cue>
        <cue name="L0M04 Cleanup">
          <condition>
            <check_value value="{value@{param@Cue}.{param@ID} L0M04 Progress}" min="1"/>
          </condition>
          <action>
            <cancel_cue cue="L0M04 Mission"/>
          </action>
        </cue>
      </cues>
    </cue>
  </cues>
  <signature>k4Y83I8ggLe49QxFNKbhpjQvBDhe8bsWKuIcPfzhTWlXjC8goqsqcrSgN+6gRfFd+afbbIsicovDZlQqaOJGgyMw9Wp04BftE5KH5r0BjLcu2vHuhWsx5cguqZ6khZi7JS7j5yZSmjaO/TTsR+KU02a3TqnnbMiSXIbe9A1eSIbXytRWcRtYXDChP8MvAb1aLLjfiYqlbILmJH08m2NkqmWKjBQj5dZGppBkrZ5a+m4huySHGBGFp+xRo4ghDB5siURbouj5xXage5bjMM0PQgdqfNXbCFXrIjOXkkD5VNSv59+KYbJsiyGkvivxTpEyxHRmb26p7i9F2CU7k6L1OA==</signature>
</director>
